<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script> <!--Regular JQuery-->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script> <!--JQuery animations-->

    <link href="CSS/stylesubmarine.css" rel="stylesheet" /> <!--We couldn't leave the styles in here, we had to move it.-->
    <script src="utils.js"></script>

    <script src="submarinsArrayJsonFile.js"></script>   <!--The JSON file with a JS extension-->
    <script>


       


      

        //Initializing the first page controls
        function init() {
         
        //    style.display = "block"
        }
        function initOldGame() {
            if (JSON.parse(localStorage.getItem("OldGameExist")) == true)
            {
                document.getElementById('GameDiv').innerHTML = localStorage["storagePBoard"];
                document.getElementById('DigitalGameDiv').innerHTML = localStorage["storageCBoard"];
            }
            else
                alert("No previous game is saved, try launching a new game!");;
          
        }
        function newGame() {
            $('welcomePage').hide();
            localStorage.clear();
            localStorage["OldGameExist"] = true;
            let str = "<table>";
            str += " <tr>";
            str += " <td class='regularTd'>Width:</td>";
            str += " <td class='regularTd'>";
            str += ' <input type="number" id="widthVar" value="15" />';
            str += " </td>";
            str += "   <td class='regularTd'>Height:</td>";
            str += "  <td class='regularTd'>";
            str += '   <input type="number" id="heightVar" value="15"/>';
            str += "     </td>";
            str += " </tr>";
            str += "   <tr>";
            str += "  <td class='regularTd'>  <input type='button'  value='run' onclick='gameConstructor()'/></td>";
            str += " </tr>";
           
            str += "   </table>";
            document.getElementById("ph").innerHTML = str;
}
        var SubMarinesBoard = [];  //Human board born here
        var SubMarinesBoard2 = []; //Computer board initialized here
        var MaxSubTdAmountC = 0; //the var that will count the amount of tbl cells holding 1..* ships

        //Starting the game constructing below:
        function gameConstructor() {
            $('.circleBtn').show();
            localStorage.clear();

            for (var boardsAmount = 0; boardsAmount < 2; boardsAmount++) {
                var BoardArr = [];// horizontal board limits
                height = parseInt(document.getElementById("heightVar").value); //Getting the height from the user input
                localStorage["storageHeight"] = height;
                width = parseInt(document.getElementById("widthVar").value); //Getting the width from the user input
                localStorage["storageWidth"] =width;

                if (height >= 10 && height <= 20 && width >= 10 && width <= 20) {
                    for (let i = 0; i < height; i++) {
                        if (i == 0) {
                            BoardArr[i] = width - 1; //  BoardArr[0] = 14
                        }
                        else {
                            BoardArr[i] = BoardArr[i - 1] + width; //BoardArr[1] = 14+15=29
                        }
                    }
                    var directionVar; // Decides which direction the submarine will be heading to
                    var shuffleArr1 = [];// Human submarines
                    var shuffleArr2 = [];// Computerized submarines
                    var subPosition = 0;
                    for (var i = 0; i < submarinesArr.length; i++) {
                        for (var j = 0; j < submarinesArr[i].amount; j++) {
                            let IsLocated = false; //If we haven't placed the boat yet, this will stay false
                            directionVar = Math.random(); //This will rand the direction of the boat, vertical or horizontal
                            while (IsLocated == false) {
                                var firstPositionVar = Math.floor(Math.random() * height * width); //Determines the first cell of our boat
                                var SubMarinePositions = [];
                                if (directionVar < 0.5) // horizontal
                                {
                                    let MaxLinePosition = MaxBorder(firstPositionVar, BoardArr);
                                    if (firstPositionVar < MaxLinePosition - (submarinesArr[i].size - 1)) //building a boat
                                    {
                                        for (var t = 0; t < submarinesArr[i].size; t++) {
                                            if (t == 0) // firstposition=22, size=3
                                                SubMarinePositions[t] = firstPositionVar;  //  shuffleArr1[x][t]=22
                                            else //If the first cell was already initialized, then let's move on to the next cell of the boat
                                                SubMarinePositions[t] = SubMarinePositions[t - 1] + 1;// t=1 ,shuffleArr1[x][t]=23
                                        }
                                        if (boardsAmount == 0) {
                                            shuffleArr1[subPosition] = SubMarinePositions; //Inserts the human boat into the array
                                        }
                                        else {
                                            shuffleArr2[subPosition] = SubMarinePositions; //Inserts the boat into the Computer array
                                        }
                                        subPosition++;
                                        IsLocated = true;
                                    }
                                    else// can't build a boat in this position
                                    {
                                        continue;
                                    }
                                }
                                else // vertical
                                {
                                    if (firstPositionVar + (submarinesArr[i].size - 1) * width < (height * width - 1))//building a boat
                                    {
                                        for (var a = 0; a < submarinesArr[i].size; a++) {
                                            if (a == 0) // firstposition=22, size=3
                                                SubMarinePositions[a] = firstPositionVar;  //  shuffleArr1[x][t]=22
                                            else
                                                SubMarinePositions[a] = SubMarinePositions[a - 1] + width;// t=1 ,shuffleArr1[x][t]=23
                                        }
                                        if (boardsAmount == 0) {
                                            shuffleArr1[subPosition] = SubMarinePositions; //Inserts the human boat into the array
                                        }
                                        else {
                                            shuffleArr2[subPosition] = SubMarinePositions; //Inserts the boat into the Computer array
                                        }
                                        subPosition++;
                                        IsLocated = true;
                                    }
                                    else { continue; }// can't build a boat in his position
                                }
                            }
                        }
                    }

                    console.log(shuffleArr1); //Prints the human boats array to the console log
                    console.log(shuffleArr2); //Prints the computer boats array to the console log

                    if (boardsAmount == 0)//Players board
                    {
                        for (let i = 0; i < shuffleArr1.length; i++) {
                            for (let j = 0; j < shuffleArr1[i].length; j++) {
                                SubMarinesBoard[shuffleArr1[i][j]] = true // i=0, j=0 SubMarinesBoard[49]=true;
                            }
                        }
                        var counter = 0;
                        localStorage["storageSubMarinesBoard"] = JSON.stringify(SubMarinesBoard);
                        var strHtml = "<table id='PBoard'>";
                        for (let i = 0; i < height; i++) {
                            strHtml += "<tr>";
                            for (let j = 0; j < width; j++) {
                                if (SubMarinesBoard[counter] == true) {
                                    strHtml += '<td class="subP" id="p' + counter + '" ></td>'; //Builds the html definition to boat class
                                }
                                else {
                                    strHtml += '<td class="yellowTd" id="p' + counter + '" ></td>'; //Builds the regular cells
                                }
                                counter++;
                            }
                            strHtml += "</tr>";
                        }
                        strHtml += "</table>";
                        localStorage["storagePBoard"] = strHtml;
                        document.getElementById("GameDiv").innerHTML = strHtml; //inserts the string from above into the doc 

                    }
                    else// computer's board
                    {
                        for (let i = 0; i < shuffleArr2.length; i++) {
                            for (let j = 0; j < shuffleArr2[i].length; j++) {
                                SubMarinesBoard2[shuffleArr2[i][j]] = true;// i=0, j=0 SubMarinesBoard[49]=true;
                            }
                        }
                        for (var d = 0; d < SubMarinesBoard2.length; d++) {
                            if (SubMarinesBoard2[d] == true)
                                MaxSubTdAmountC++;
                           
                        }
                        localStorage["storageMaxSubTdAmountC"] = MaxSubTdAmountC;
                        localStorage["storageSubMarinesBoard2"] = JSON.stringify(SubMarinesBoard2);
                        var counter = 0; //our ID var
                        var strHtml = '<table id="CBoard">'; //Creates the computer grid board by a tbl
                        for (let i = 0; i < height; i++) {
                            strHtml += "<tr>";
                            for (let j = 0; j < width; j++) {
                                strHtml += '<td class="yellowTd" id="' + counter + '" onclick="Game(this.id)"></td>'; //Builds the regular cells and tells them that if they are being clicked, that means that they have a function standing behind them
                                counter++; //assigns the ID to each human board cell
                            }
                            strHtml += "</tr>";
                        }
                        strHtml += "</table>";
                        localStorage["storageCBoard"] = strHtml;

                        //CheatBTN is here to reveal the locations
                        //extraCheat is here for demolition of all the computer's submarines in one shot, and one click anywhere in the computer board to end the game.
                        strHtml += '<button id="cheat" title="If clicked, all of the computer ships will be REVEALED." onclick="cheat()">cheat:)</button>';
                        strHtml += '<button id="extraCheat" title="If clicked, All of the computer ships will be DESTROYED, and all you will have to do to move on is just click any where you want in the computer board.." onclick="extraCheat()">Extra cheat:)</button>';

                        document.getElementById("DigitalGameDiv").innerHTML = strHtml;
                    }
                } else alert("Heigt and Width must have a value between 10 to 20 ");
            }


        } //end of gameconstructor

        function moveIt() { // MOVE IT, we wanna bust your radio, MOVE IT, double a shot like SUBMARINE STEREO
            $('.pauseMusicBtn').show(); //reveals the STOP THE MUSIC btn

            $("#twoBoards").animate({ //a little bit downstairs
                top: "+=300px",
            }, "3000");
            $("#twoBoards").animate({ //a little bit to the right
                left: "+=300px",
            }, "3000");
            $("#twoBoards").animate({ //a little back up
                top: "-=300px",
            }, "3000");
            $("#twoBoards").animate({ //a little back to the left
                left: "-=300px",
            }, "3000");
            var audio = document.getElementById("audio"); 
            $('#audio').show(); // show our amazing youtube circle song
        }

        function removeAnimate() { //animation removal function
            $('#audio').remove(); // removes the youtube frm from the doc
            $('.pauseMusicBtn').remove(); //removes the "stop the music" btn from the doc coz we dont need it anymore
        }

        function MaxBorder(location, BoardArr) { // returns the cell limits of the horizontal row
            for (var i = 0; i < BoardArr.length; i++) { 
                if (location <= BoardArr[0]) { 
                    return BoardArr[i]; //14
                }
                else if (location >= BoardArr[i] && location <= BoardArr[i + 1]) // i=1, BoardArr[i]=14, BoardArr[i + 1]=29
                {
                    return BoardArr[i + 1]; // 29
                }
                else {
                    continue;
                }
            }
        }
        function Game(ParameterId) {
            let ComputerTd = document.getElementById(ParameterId);//Computers td
            if (ComputerTd.className == "yellowTd" || ComputerTd.className == "subC") {
                if (SubMarinesBoard2[ParameterId] == true) { ComputerTd.className = "RedTdC"; }
                else { ComputerTd.className = "GreyTd"; }
                //end of players turn
                var ComputerPlayed = false;
                while (ComputerPlayed == false) {
                    var ComputerTurn = Math.floor(Math.random() * height * width);
                    var RandPositionP = document.getElementById("p" + ComputerTurn);//players td
                    if (RandPositionP.className != "RedTdP" || RandPositionP.className != "GreyTd") {
                        if (SubMarinesBoard[ComputerTurn] == true) { RandPositionP.className = "RedTdP"; }
                        else { RandPositionP.className = "GreyTd"; }
                        ComputerPlayed = true;
                    }


                }
                let PlayerdWins = document.getElementsByClassName('RedTdC'); //Human player wins
               
                if (PlayerdWins.length == MaxSubTdAmountC) {
                    $('.game').hide();
                    $('#GameOver').show();
                    alert("The Player has won!");

                }
                let ComputersWins = document.getElementsByClassName('RedTdP');
                let MaxSubTdAmountP = document.getElementsByClassName('subP'); //number of subs td in players board
                if (ComputersWins.length == MaxSubTdAmountP) {
                    $('.game').hide();
                    $('#GameOver').show();
                    alert("The computer has won!");
                }
            }
        }

        function cheat() {
            for (var i = 0; i < SubMarinesBoard2.length; i++) {
                var Temptd = document.getElementById(i);
                if (SubMarinesBoard2[i] == true && Temptd.className == "yellowTd") { Temptd.className = "subC"; }

            }
        }
        function extraCheat() {
            for (var i = 0; i < SubMarinesBoard2.length; i++) {
                var Temptd = document.getElementById(i);
                if (SubMarinesBoard2[i] == true && Temptd.className == "yellowTd") { Temptd.className = "RedTdC"; }

            }
        }
        
     
    </script>
</head>
<body onload="init()">
    <div id="welcomePage">
        <input type='button' id="newGameBTN" title='Initialize a new game' value='New Game' onclick='newGame()' />
        <input type='button' id="oldGameBTN" title='Return to previous game' value='Load previous progress' onclick='initOldGame()' />
    </div>
        
    <div id="ph" class="game"></div> <!--//Controlers Div-->
    <div id="twoBoards" class="game">
        <div id="GameDiv"></div><!--// Human Board Div-->
        <div id="DigitalGameDiv"></div><!--// Computer</div> Board Div-->
    </div>
    <div id="GameOver">
        <img src="images/gameover.jpg" />
    </div>
    <div id="audio"> <!--added as we love the circle song and it suits our circly animation-->
        <iframe width="560" height="315" src="https://www.youtube.com/embed/LlXnXf6FSq8?autoplay=1&start=10&mute=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
    </div>
    <footer class="main-footer">
            <nav class="main-menu">
        <ul>
            <li><a href="AlmogSkalka.html">Home</a></li>
            <li><a href="AlmogSkalka-aboutus.html">About</a></li>
            <li><a href="JS-Submarine.html">Submarine JavaScript</a></li>

            <li><a href="#">Services</a></li>
            <li><a href="products.html">Products</a></li>
            <li><a href="almogskalka-contactus.html">Contact</a></li>
        </ul>
    </nav>
</footer>
</body>
</html>